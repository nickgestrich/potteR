---
title: "Example workflow for ceramic analysis using potteR"
author: "Nick Gestrich"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{ceramic_analysis_workflow}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(potteR)
library(dplyr)
library(ggplot2)
```

## Example Data

This example runs on data from a 2023 excavation in the Republic of Guinea. These are recorded using a modified version of the system proposed by Jesse & Nowotnick (2022). It is included in the package.

```{r}
rims <- guinea[[1]]
body <- guinea[[2]]

#some of the observations on rims are not made on body sherds. We will treat these observations separately
all <- guinea[[3]]

r <- names(rims)[! names(rims) %in% names(body)]

rims_only <- rims |> 
  select(all_of(r), site, sondage, context, unit_id, sond_con)
```

## Summary statistics

We would like a report of key statistics and counts. This means counts of unique values in the categorical variables, and summaries of the numeric variables. PotteR provides these as an R object in a list, and as a pdf report for perusal outside of R. 

```{r}
# make a list of summaries for every variable
rim_summary <- get_summary(rims_only)

# to generate a pdf report, uncomment and run the code below
# print_summary(rims_only, file = here::here("summary.pdf"))
```

Bivariate

```{r}
# it might be a good idea to center and standardise numerical values before analysing their distribution.
center_and_standardise <- function(x) (x - mean(x, na.rm = TRUE) / sd(x, na.rm = TRUE))
```

Plots

Maps

## Seriation

An important aspect of ceramic analysis is to find attributes or types that seriate. This has two main interpretive ends in archaeology. The first is to create orders in previously unordered data, for instance in a series of samples from survey or shovel testing. The second is to identify developments in series that have pre-defined orders, such as contexts from stratigraphic excavations. 

### Using seriation to order assemblages

### Identifying developments in ordered assemblages

We will here aim our seriation plot at decor types and rim types. We use the plot_ford() function from the tabula package to make these plots. The function given here adds ease in data preparation.

A predefined order has to be given for the contexts or assemblages. This is then used as the context_order argument in the function.

```{r}
# Stratigraphic order of contexts for Unit B
b_order <- c("1", "2", "3", "4", "5",  "6", "7",  "8",  "9",  "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23",  "24", "25", "26")

rims_only |> 
  filter(sondage == "B") |> # select only Unit B
  plot_series(context, rim_type, b_order)
```

Since the returned plot is a ggplot object, it can be modified using ggplot syntax to add titles etc., e.g.:

```{r}
rims_only |> 
  filter(sondage == "B") |> # select only Unit B
  plot_series(context, rim_type, b_order) +
  labs(title = "Rim Types from Unit B",
       subtitle = "NDK1")
```


Finding Groups

Significance and Standardisation
