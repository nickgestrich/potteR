---
title: "Example workflow for ceramic analysis using potteR"
author: "Nick Gestrich"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{ceramic_analysis_workflow}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(potteR)
library(dplyr)
```

## Example Data

This example runs on data from a 2023 excavation in the Republic of Guinea. These are recorded using a modified version of the system proposed by Jesse & Nowotnick (2022). It is included in the package.

```{r}
rims <- guinea[[1]]
body <- guinea[[2]]

#some of the observations on rims are not made on body sherds. We will treat these observations separately
all <- guinea[[3]]

r <- names(rims)[! names(rims) %in% names(body)]

rims_only <- rims |> 
  select(all_of(r), site, sondage, context, unit_id, sond_con)
```

## Summary statistics

We would like a report of key statistics and counts. This means counts of unique values in the categorical variables, and summaries of the numeric variables

```{r}
rim_summary <- get_summary(rims_only)

library(gridExtra)
pdf(here::here("summary.pdf"))
for(i in rim_summary){
  grid.table(i)
  }
dev.off()

library(gridExtra)
library(grid)

pdf(here::here("summary.pdf"))
x <- purrr::map2(
  rim_summary, names(rim_summary), function(x, y)
  {knitr::kable(x, "simple", caption = paste(y))})
dev.off()
kableExtra::save_kable(x, file = here::here("summary.pdf"))

x |> 
purrr::imap(~
    kableExtra::save_kable(file = here::here("summary.pdf")),
                  bs_theme = 'journal', 
                  self_contained = T, 
                  x = kbl(.x, booktabs = T, align = c('l','l', 'c')) %>%
                    kable_styling() 
                   )




myfunction <- function(data, file){
  
  r <- get_summary(data)
  
  cat("---
title: \"Summary of variables\"
date: '`r strftime(Sys.time())`'
output: 
  pdf_document:
  df_print: kable
    
---
  
\`\`\`{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
\`\`\`

## Example
\`\`\`{r example, echo=FALSE}
r <- potteR::get_summary(data)

out <- purrr::map(
    r,
    function(tt){
        knitr::kable(tt)
        }
    )

out |> purrr::map(print)
\`\`\`", 
file = "tmp.Rmd")
  rmarkdown::render("tmp.Rmd", output_file = file)
}

myfunction(rims_only, file = here::here("summary.pdf"))

# need to cut off at 20 rows.

print(x)


t <- purrr::map2(
  rim_summary, names(rim_summary), 
  function(x, y){
    knitr::kable(x, caption = paste(y))
    }
  )
#
t |> purrr::map(print)
```

Bivariate

```{r}
# it might be a good idea to center and standardise numerical values before analysing their distribution.
center_and_standardise <- function(x) (x - mean(x, na.rm = TRUE) / sd(x, na.rm = TRUE))
```

Plots

Maps

Seriation

Finding Groups

Significance and Standardisation
